pipeline{
    agent any
    environment {
        IMAGE_NAME='myhttpd'
        VERSION = "v${BUILD_ID}.${BUILD_NUMBER}" //v12.13
        DOCKER_USERNAME= 'admin' //x
        DOCKER_PASSWORD= 'mama maglione pizza' //x
        
    }
    stages{
        stage("Docker-Verify"){
            steps{
               withCredentials([usernamePassword(credentialsId: 'DockerCred',usernameVariable:'USERNAME',passwordVariable:'PASS')]){
                    sh 'echo username : ${USERNAME}'
                    sh 'echo password : ${PASS}'
                    sh 'docker login --username ${USERNAME} --password ${PASS} https://hub.docker.com'

               }
               sh 'docker --version'
            }
        }
        
        stage("internet-Verify"){
            steps{
                retry(3){
                    timeout(time: 1, unit: 'SECONDS'){
                        sh 'ping -c 30 8.8.8.8&'
                    }
                }
            }
        }
        stage("git-Verify"){
            steps{
               sh 'git --version'
            }
        }
        stage("docker-build"){
            steps{
                dir('Labs'){
                    sh 'pwd'
                    sleep(10)
                    dir('Task6'){
                        timeout(time: 4 , unit: 'SECONDS'){
                            sh 'docker build -t ${IMAGE_NAME}:${VERSION} .' // docker build -t jenbababab:latest --file ./Labs/Task6/Dockerfile .
                        }
                    }
                }
            }
        }
        stage("docker-image-verify"){
            steps{
                 sh 'docker images | grep -i ${IMAGE_NAME}' // docker build -t jenbababab:latest --file ./Labs/Task6/Dockerfile . 
                }
        }
    }
  
}